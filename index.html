<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .lang-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            padding: 8px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .lang-btn.active {
            background: #667eea;
            color: white;
        }
        
        .section {
            margin-bottom: 25px;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .package-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .package-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .package-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .package-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .package-card .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b6b;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .package-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        
        .package-price {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .package-details {
            font-size: 12px;
            color: #666;
            line-height: 1.5;
        }
        
        .addon-options {
            margin-top: 15px;
        }
        
        .addon-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .addon-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .instructions {
            background: #fff9e6;
            border-left: 4px solid #ffd700;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .instructions h3 {
            color: #d4a017;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            margin-left: 20px;
            color: #666;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .image-upload {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload:hover {
            background: #f0f4ff;
        }
        
        .image-upload img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .price-summary {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .price-total {
            border-top: 2px solid #667eea;
            padding-top: 15px;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-message {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 60px;
            color: #4caf50;
            margin-bottom: 20px;
        }
        
        .map-container {
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainTitle">‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î</h1>
            <p id="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
        </div>
        
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLanguage('th')">‡πÑ‡∏ó‡∏¢</button>
            <button class="lang-btn" onclick="setLanguage('en')">English</button>
        </div>
        
        <!-- Loading Screen -->
        <div id="loadingSection" class="section active">
            <div class="loading">
                <div class="spinner"></div>
                <p id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
        
        <!-- Customer Type Check -->
        <div id="customerTypeSection" class="section">
            <h2 id="welcomeText">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!</h2>
            <p id="customerTypeText"></p>
        </div>
        
        <!-- New Customer Registration -->
        <div id="newCustomerSection" class="section">
            <h2 id="registerTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
            
            <div class="form-group">
                <label id="labelRoomNumber">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô *</label>
                <input type="text" id="roomNumber" placeholder="‡πÄ‡∏ä‡πà‡∏ô 123, A-456">
            </div>
            
            <div class="form-group">
                <label id="labelLocationName">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î / ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô *</label>
                <input type="text" id="locationName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡∏≠‡∏∞ ‡πÄ‡∏ö‡∏™ ‡πÅ‡∏à‡πâ‡∏á‡∏ß‡∏±‡∏í‡∏ô‡∏∞">
            </div>
            
            <div class="form-group">
                <label id="labelLocationType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
                <select id="locationType">
                    <option value="condo">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏° / Condominium</option>
                    <option value="village">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô / Village</option>
                    <option value="apartment">‡∏≠‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏°‡∏ô‡∏ó‡πå / Apartment</option>
                    <option value="house">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏î‡∏µ‡πà‡∏¢‡∏ß / House</option>
                </select>
            </div>
            
            <div class="form-group">
                <label id="labelLocation">‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô *</label>
                <button class="btn btn-secondary" onclick="getLocation()" id="btnGetLocation">
                    üìç ‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                </button>
                <div id="mapContainer" class="map-container hidden"></div>
                <p id="locationStatus" style="margin-top: 10px; color: #666; font-size: 14px;"></p>
            </div>
            
            <div class="form-group">
                <label id="labelPickupPoint">‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ *</label>
                <textarea id="pickupPoint" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡πâ‡∏≠‡∏á, ‡πÇ‡∏ï‡πä‡∏∞‡∏£‡∏±‡∏ö‡∏ù‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡πâ‡∏ô 1"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="registerNewCustomer()" id="btnRegister">
                ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
            </button>
        </div>
        
        <!-- Service Selection -->
        <div id="serviceSection" class="section">
            <h2 id="serviceTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
            
            <div class="instructions">
                <h3 id="instructionsTitle">üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤</h3>
                <ul id="instructionsList">
                    <li>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô</li>
                    <li>‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô</li>
                    <li>‡∏ñ‡∏∏‡∏á‡∏Ñ‡∏•‡∏∏‡∏°‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏ú‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</li>
                </ul>
            </div>
            
            <div class="form-group">
                <label id="labelServiceType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ *</label>
                <select id="serviceType" onchange="updateServiceOptions()">
                    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ --</option>
                    <option value="package">‡πÅ‡∏ö‡∏ö Package</option>
                    <option value="perpiece">‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</option>
                </select>
            </div>
            
            <!-- Package Options -->
            <div id="packageOptions" class="hidden">
                <h3 id="packageTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package</h3>
                <div class="package-grid" id="packageGrid"></div>
                
                <!-- Add-on Services -->
                <div id="addonSection" class="hidden">
                    <h3 id="addonTitle" style="margin-top: 25px;">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)</h3>
                    <div class="addon-options" id="addonOptions"></div>
                </div>
            </div>
            
            <!-- Per Piece Note -->
            <div id="perpieceNote" class="hidden">
                <div class="instructions">
                    <p id="perpieceText">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                </div>
            </div>
            
            <!-- Price Summary -->
            <div id="priceSummary" class="price-summary hidden">
                <div class="price-row">
                    <span id="summaryPackage">Package:</span>
                    <span id="summaryPackagePrice">0 ‡∏ø</span>
                </div>
                <div class="price-row" id="addonRow" class="hidden">
                    <span id="summaryAddon">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°:</span>
                    <span id="summaryAddonPrice">0 ‡∏ø</span>
                </div>
                <div class="price-total">
                    <span id="summaryTotal">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="summaryTotalPrice">0 ‡∏ø</span>
                </div>
            </div>
            
            <!-- Image Upload -->
            <div class="form-group">
                <label id="labelImage">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ñ‡∏∏‡∏á‡∏ú‡πâ‡∏≤ *</label>
                <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                    <p id="uploadText">üì∏ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ</p>
                    <input type="file" id="imageInput" accept="image/*" capture="environment" style="display: none;" onchange="handleImageSelect(event)">
                    <img id="imagePreview" style="display: none;">
                </div>
            </div>
            
            <div class="form-group">
                <label id="labelNotes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                <textarea id="orderNotes" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="submitOrder()" id="btnSubmit">
                ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            </button>
        </div>
        
        <!-- Success -->
        <div id="successSection" class="section">
            <div class="success-message">
                <div class="success-icon">‚úÖ</div>
                <h2 id="successTitle">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                <p id="successMessage" style="color: #666; margin: 20px 0;">
                    ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ
                </p>
                <p id="orderIdText" style="font-size: 14px; color: #999;"></p>
                <button class="btn btn-primary" onclick="liff.closeWindow()" id="btnClose">
                    ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyna2QwCDAcIlXUvIQeMwSQ3by8iwQds6sEVZ-NHevk5JvX0kz6Y1vj8dshnB3el6El/exec'; // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Apps Script
        
        // Global Variables
        let currentLanguage = 'th';
        let userId = '';
        let displayName = '';
        let isNewCustomer = true;
        let customerData = {};
        let selectedPackage = null;
        let selectedAddon = null;
        let latitude = null;
        let longitude = null;
        let uploadedImageBase64 = null;
        
        // Language Pack
        const lang = {
            th: {
                mainTitle: '‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î',
                subtitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                loadingText: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                welcomeText: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö!',
                registerTitle: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',
                labelRoomNumber: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á / ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô *',
                labelLocationName: '‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î / ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô *',
                labelLocationType: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *',
                labelLocation: '‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô *',
                btnGetLocation: 'üìç ‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô',
                labelPickupPoint: '‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ *',
                btnRegister: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                serviceTitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                instructionsTitle: 'üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤',
                instruction1: '‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô‡πÄ‡∏™‡∏∑‡πâ‡∏≠ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô',
                instruction2: '‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏ö ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏°‡πâ‡πÅ‡∏Ç‡∏ß‡∏ô',
                instruction3: '‡∏ñ‡∏∏‡∏á‡∏Ñ‡∏•‡∏∏‡∏°‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏ú‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ',
                labelServiceType: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ *',
                selectServiceType: '-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ --',
                packageType: '‡πÅ‡∏ö‡∏ö Package',
                perpieceType: '‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô',
                packageTitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package',
                addonTitle: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ)',
                perpieceText: '‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                summaryPackage: 'Package:',
                summaryAddon: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°:',
                summaryTotal: '‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:',
                labelImage: '‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ñ‡∏∏‡∏á‡∏ú‡πâ‡∏≤ *',
                uploadText: 'üì∏ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ',
                labelNotes: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
                btnSubmit: '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠',
                successTitle: '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                successMessage: '‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ',
                orderIdText: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:',
                btnClose: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á',
                freeBlanket: '‡πÅ‡∏ñ‡∏°‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏°‡∏ü‡∏£‡∏µ 1 ‡∏ú‡∏∑‡∏ô'
            },
            en: {
                mainTitle: 'Laundry Service',
                subtitle: 'Select your service',
                loadingText: 'Loading...',
                welcomeText: 'Welcome!',
                registerTitle: 'New Customer Registration',
                labelRoomNumber: 'Room / House Number *',
                labelLocationName: 'Condo / Village Name *',
                labelLocationType: 'Type *',
                labelLocation: 'Share Location *',
                btnGetLocation: 'üìç Share My Location',
                labelPickupPoint: 'Pickup/Delivery Point *',
                btnRegister: 'Register',
                serviceTitle: 'Select Service',
                instructionsTitle: 'üìã How to Send Laundry',
                instruction1: 'Prepare hangers for clothes you want hung',
                instruction2: 'If you want folded, no hangers needed',
                instruction3: 'You can reuse the plastic bag with your room number',
                labelServiceType: 'Service Type *',
                selectServiceType: '-- Select Service Type --',
                packageType: 'Package',
                perpieceType: 'Per Piece',
                packageTitle: 'Select Package',
                addonTitle: 'Add-on Services (Optional)',
                perpieceText: 'For per-piece service, charges are based on actual items according to our price list',
                summaryPackage: 'Package:',
                summaryAddon: 'Add-on:',
                summaryTotal: 'Total:',
                labelImage: 'Take Photo of Laundry Bag *',
                uploadText: 'üì∏ Click to Take Photo',
                labelNotes: 'Additional Notes',
                btnSubmit: 'Submit Order',
                successTitle: 'Order Submitted!',
                successMessage: 'We will contact you soon',
                orderIdText: 'Order ID:',
                btnClose: 'Close Window',
                freeBlanket: 'Free blanket wash included'
            }
        };
        
        // Package Data
        const packages = {
            th: [
                { id: 'wash_iron_50', name: '‡∏ã‡∏±‡∏Å+‡∏£‡∏µ‡∏î 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 800, size: 50, type: 'wash_iron' },
                { id: 'wash_iron_100', name: '‡∏ã‡∏±‡∏Å+‡∏£‡∏µ‡∏î 100 ‡∏ä‡∏¥‡πâ‡∏ô', price: 1600, size: 100, type: 'wash_iron', badge: '‡πÅ‡∏ñ‡∏°‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏°‡∏ü‡∏£‡∏µ 1 ‡∏ú‡∏∑‡∏ô' },
                { id: 'iron_50', name: '‡∏£‡∏µ‡∏î 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 600, size: 50, type: 'iron' },
                { id: 'iron_100', name: '‡∏£‡∏µ‡∏î 100 ‡∏ä‡∏¥‡πâ‡∏ô', price: 1180, size: 100, type: 'iron' },
                { id: 'wash_dry_50', name: '‡∏ã‡∏±‡∏Å+‡∏≠‡∏ö 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 450, size: 50, type: 'wash_dry' },
                { id: 'wash_dry_100', name: '‡∏ã‡∏±‡∏Å+‡∏≠‡∏ö 100 ‡∏ä‡∏¥‡πâ‡∏ô', price: 880, size: 100, type: 'wash_dry' }
            ],
            en: [
                { id: 'wash_iron_50', name: 'Wash+Iron 50 pcs', price: 800, size: 50, type: 'wash_iron' },
                { id: 'wash_iron_100', name: 'Wash+Iron 100 pcs', price: 1600, size: 100, type: 'wash_iron', badge: 'Free blanket wash' },
                { id: 'iron_50', name: 'Iron Only 50 pcs', price: 600, size: 50, type: 'iron' },
                { id: 'iron_100', name: 'Iron Only 100 pcs', price: 1180, size: 100, type: 'iron' },
                { id: 'wash_dry_50', name: 'Wash+Dry 50 pcs', price: 450, size: 50, type: 'wash_dry' },
                { id: 'wash_dry_100', name: 'Wash+Dry 100 pcs', price: 880, size: 100, type: 'wash_dry' }
            ]
        };
        
        // Add-on Data
        const addons = {
            th: [
                { id: 'separate_50', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 150, size: 50 },
                { id: 'separate_100', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 300, size: 100 },
                { id: 'hand_wash_50', name: '‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 150, size: 50 },
                { id: 'hand_wash_100', name: '‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 300, size: 100 },
                { id: 'both_50', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å+‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 250, size: 50 },
                { id: 'both_100', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å+‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 500, size: 100 }
            ],
            en: [
                { id: 'separate_50', name: 'Separate Wash (50 pcs)', price: 150, size: 50 },
                { id: 'separate_100', name: 'Separate Wash (100 pcs)', price: 300, size: 100 },
                { id: 'hand_wash_50', name: 'Hand Wash (50 pcs)', price: 150, size: 50 },
                { id: 'hand_wash_100', name: 'Hand Wash (100 pcs)', price: 300, size: 100 },
                { id: 'both_50', name: 'Separate+Hand Wash (50 pcs)', price: 250, size: 50 },
                { id: 'both_100', name: 'Separate+Hand Wash (100 pcs)', price: 500, size: 100 }
            ]
        };
        
        // Initialize LIFF
        window.onload = function() {
            liff.init({ liffId: '2008959129-6kAJzyzg' }) // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                .then(() => {
                    if (!liff.isLoggedIn()) {
                        liff.login();
                    } else {
                        initializeApp();
                    }
                })
                .catch((err) => {
                    console.error('LIFF init failed', err);
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE');
                });
        };
        
        async function initializeApp() {
            try {
                const profile = await liff.getProfile();
                userId = profile.userId;
                displayName = profile.displayName;
                
                // Check if new or existing customer
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'checkCustomer',
                        userId: userId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    isNewCustomer = data.data.isNewCustomer;
                    
                    if (!isNewCustomer) {
                        customerData = data.data.customerData;
                        currentLanguage = customerData.language || 'th';
                        setLanguage(currentLanguage);
                        showSection('serviceSection');
                    } else {
                        showSection('newCustomerSection');
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
            }
        }
        
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update all text elements
            updateLanguage();
        }
        
        function updateLanguage() {
            const l = lang[currentLanguage];
            
            document.getElementById('mainTitle').textContent = l.mainTitle;
            document.getElementById('subtitle').textContent = l.subtitle;
            document.getElementById('loadingText').textContent = l.loadingText;
            document.getElementById('welcomeText').textContent = l.welcomeText;
            document.getElementById('registerTitle').textContent = l.registerTitle;
            document.getElementById('labelRoomNumber').textContent = l.labelRoomNumber;
            document.getElementById('labelLocationName').textContent = l.labelLocationName;
            document.getElementById('labelLocationType').textContent = l.labelLocationType;
            document.getElementById('labelLocation').textContent = l.labelLocation;
            document.getElementById('btnGetLocation').textContent = l.btnGetLocation;
            document.getElementById('labelPickupPoint').textContent = l.labelPickupPoint;
            document.getElementById('btnRegister').textContent = l.btnRegister;
            document.getElementById('serviceTitle').textContent = l.serviceTitle;
            document.getElementById('instructionsTitle').textContent = l.instructionsTitle;
            
            // Update instructions list
            const instructionsList = document.getElementById('instructionsList');
            instructionsList.innerHTML = `
                <li>${l.instruction1}</li>
                <li>${l.instruction2}</li>
                <li>${l.instruction3}</li>
            `;
            
            document.getElementById('labelServiceType').textContent = l.labelServiceType;
            
            const serviceTypeSelect = document.getElementById('serviceType');
            serviceTypeSelect.innerHTML = `
                <option value="">${l.selectServiceType}</option>
                <option value="package">${l.packageType}</option>
                <option value="perpiece">${l.perpieceType}</option>
            `;
            
            document.getElementById('packageTitle').textContent = l.packageTitle;
            document.getElementById('addonTitle').textContent = l.addonTitle;
            document.getElementById('perpieceText').textContent = l.perpieceText;
            document.getElementById('summaryPackage').textContent = l.summaryPackage;
            document.getElementById('summaryAddon').textContent = l.summaryAddon;
            document.getElementById('summaryTotal').textContent = l.summaryTotal;
            document.getElementById('labelImage').textContent = l.labelImage;
            document.getElementById('uploadText').textContent = l.uploadText;
            document.getElementById('labelNotes').textContent = l.labelNotes;
            document.getElementById('btnSubmit').textContent = l.btnSubmit;
            document.getElementById('successTitle').textContent = l.successTitle;
            document.getElementById('successMessage').textContent = l.successMessage;
            document.getElementById('btnClose').textContent = l.btnClose;
        }
        
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }
        
        async function getLocation() {
            if (navigator.geolocation) {
                document.getElementById('locationStatus').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...';
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        
                        document.getElementById('locationStatus').textContent = 
                            `‚úì ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        document.getElementById('locationStatus').style.color = '#4caf50';
                    },
                    (error) => {
                        document.getElementById('locationStatus').textContent = 
                            '‚úó ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á';
                        document.getElementById('locationStatus').style.color = '#ff6b6b';
                    }
                );
            } else {
                alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Geolocation');
            }
        }
        
        async function registerNewCustomer() {
            const roomNumber = document.getElementById('roomNumber').value.trim();
            const locationName = document.getElementById('locationName').value.trim();
            const locationType = document.getElementById('locationType').value;
            const pickupPoint = document.getElementById('pickupPoint').value.trim();
            
            if (!roomNumber || !locationName || !pickupPoint) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            if (!latitude || !longitude) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô');
                return;
            }
            
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'registerCustomer',
                        userId: userId,
                        displayName: displayName,
                        roomNumber: roomNumber,
                        locationName: locationName,
                        locationType: locationType,
                        latitude: latitude,
                        longitude: longitude,
                        pickupPoint: pickupPoint,
                        language: currentLanguage
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    isNewCustomer = false;
                    customerData = {
                        roomNumber: roomNumber,
                        locationName: locationName,
                        locationType: locationType,
                        pickupPoint: pickupPoint
                    };
                    
                    showSection('serviceSection');
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô');
            }
        }
        
        function updateServiceOptions() {
            const serviceType = document.getElementById('serviceType').value;
            
            document.getElementById('packageOptions').classList.add('hidden');
            document.getElementById('perpieceNote').classList.add('hidden');
            document.getElementById('priceSummary').classList.add('hidden');
            
            if (serviceType === 'package') {
                document.getElementById('packageOptions').classList.remove('hidden');
                renderPackages();
            } else if (serviceType === 'perpiece') {
                document.getElementById('perpieceNote').classList.remove('hidden');
            }
        }
        
        function renderPackages() {
            const grid = document.getElementById('packageGrid');
            grid.innerHTML = '';
            
            packages[currentLanguage].forEach(pkg => {
                const card = document.createElement('div');
                card.className = 'package-card';
                card.onclick = () => selectPackage(pkg);
                
                card.innerHTML = `
                    ${pkg.badge ? `<span class="badge">${pkg.badge}</span>` : ''}
                    <div class="package-title">${pkg.name}</div>
                    <div class="package-price">${pkg.price} ‡∏ø</div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function selectPackage(pkg) {
            selectedPackage = pkg;
            selectedAddon = null;
            
            // Update UI
            document.querySelectorAll('.package-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show addon options
            document.getElementById('addonSection').classList.remove('hidden');
            renderAddons(pkg.size);
            
            // Update price summary
            updatePriceSummary();
        }
        
        function renderAddons(packageSize) {
            const container = document.getElementById('addonOptions');
            container.innerHTML = '';
            
            const filteredAddons = addons[currentLanguage].filter(addon => addon.size === packageSize);
            
            filteredAddons.forEach(addon => {
                const card = document.createElement('div');
                card.className = 'addon-card';
                card.onclick = () => selectAddon(addon);
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span>${addon.name}</span>
                        <span style="font-weight: 700; color: #667eea;">+${addon.price} ‡∏ø</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function selectAddon(addon) {
            if (selectedAddon && selectedAddon.id === addon.id) {
                selectedAddon = null;
                event.currentTarget.classList.remove('selected');
            } else {
                selectedAddon = addon;
                document.querySelectorAll('.addon-card').forEach(card => {
                    card.classList.remove('selected');
                });
                event.currentTarget.classList.add('selected');
            }
            
            updatePriceSummary();
        }
        
        function updatePriceSummary() {
            if (!selectedPackage) return;
            
            const summary = document.getElementById('priceSummary');
            summary.classList.remove('hidden');
            
            let totalPrice = selectedPackage.price;
            
            document.getElementById('summaryPackagePrice').textContent = selectedPackage.price + ' ‡∏ø';
            
            if (selectedAddon) {
                document.getElementById('addonRow').classList.remove('hidden');
                document.getElementById('summaryAddonPrice').textContent = '+' + selectedAddon.price + ' ‡∏ø';
                totalPrice += selectedAddon.price;
            } else {
                document.getElementById('addonRow').classList.add('hidden');
            }
            
            document.getElementById('summaryTotalPrice').textContent = totalPrice + ' ‡∏ø';
        }
        
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageBase64 = e.target.result;
                const preview = document.getElementById('imagePreview');
                preview.src = uploadedImageBase64;
                preview.style.display = 'block';
                document.getElementById('uploadText').textContent = '‚úì ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)';
            };
            reader.readAsDataURL(file);
        }
        
        async function submitOrder() {
            const serviceType = document.getElementById('serviceType').value;
            
            if (!serviceType) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£');
                return;
            }
            
            if (serviceType === 'package' && !selectedPackage) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package');
                return;
            }
            
            if (!uploadedImageBase64) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏ñ‡∏∏‡∏á‡∏ú‡πâ‡∏≤');
                return;
            }
            
            const orderData = {
                action: 'submitOrder',
                userId: userId,
                roomNumber: isNewCustomer ? document.getElementById('roomNumber').value : customerData.roomNumber,
                locationName: isNewCustomer ? document.getElementById('locationName').value : customerData.locationName,
                serviceType: serviceType,
                packageType: selectedPackage ? selectedPackage.id : 'perpiece',
                addOnService: selectedAddon ? selectedAddon.id : '',
                totalPrice: selectedPackage ? (selectedPackage.price + (selectedAddon ? selectedAddon.price : 0)) : 0,
                imageUrl: uploadedImageBase64,
                notes: document.getElementById('orderNotes').value
            };
            
            try {
                // Show loading
                showSection('loadingSection');
                
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify(orderData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('orderIdText').textContent = 
                        lang[currentLanguage].orderIdText + ' ' + data.data.orderId;
                    showSection('successSection');
                    
                    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡∏¢‡∏±‡∏á Chat (Optional)
                    if (liff.isApiAvailable('shareTargetPicker')) {
                        liff.shareTargetPicker([{
                            type: 'text',
                            text: `‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!\n‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç: ${data.data.orderId}\n‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô`
                        }]);
                    }
                } else {
                    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                    showSection('serviceSection');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
                showSection('serviceSection');
            }
        }
    </script>
</body>

</html>

