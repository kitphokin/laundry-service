<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .lang-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            padding: 8px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .lang-btn.active {
            background: #667eea;
            color: white;
        }
        
        .section {
            margin-bottom: 25px;
            display: none;
        }
        
        .section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .info-box {
            background: #fff9e6;
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .info-box h3 {
            color: #ff9800;
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
            margin: 5px 0;
        }
        
        .info-box ul {
            margin: 10px 0 0 20px;
            color: #555;
        }
        
        .info-box li {
            margin: 5px 0;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        
        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .package-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .package-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .package-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 100%);
        }
        
        .addon-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .addon-card:hover {
            border-color: #667eea;
        }
        
        .addon-card.selected {
            border-color: #667eea;
            background: #e8eaf6;
        }
        
        .price-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .success-message {
            text-align: center;
            padding: 40px 20px;
        }
        
        .success-icon {
            font-size: 60px;
            color: #4caf50;
            margin-bottom: 20px;
        }
        
        .error-message {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #c62828;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainTitle">‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î</h1>
            <p id="subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
        </div>
        
        <div class="lang-switch">
            <button class="lang-btn active" onclick="setLanguage('th')">‡πÑ‡∏ó‡∏¢</button>
            <button class="lang-btn" onclick="setLanguage('en')">English</button>
        </div>
        
        <!-- Loading Screen -->
        <div id="loadingSection" class="section active">
            <div class="loading">
                <div class="spinner"></div>
                <p id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
        
        <!-- Error Screen -->
        <div id="errorSection" class="section">
            <div class="error-message">
                <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
                <p id="errorMessage"></p>
                <button class="btn btn-primary" onclick="location.reload()">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            </div>
        </div>
        
        <!-- New Customer Registration -->
        <div id="newCustomerSection" class="section">
            <h2 id="registerTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
            
            <!-- Info Box -->
            <div class="info-box">
                <h3>üì∏üìç ‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p id="infoBoxText">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô LINE chat ‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:</p>
                <ul>
                    <li id="infoPhoto">üì∏ ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å</li>
                    <li id="infoLocation">üìç ‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏≠‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)</li>
                </ul>
                <p style="color: #999; font-size: 13px; margin-top: 10px;" id="infoNote">
                    (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)
                </p>
            </div>
            
            <form id="registerForm">
                <div class="form-group">
                    <label id="labelRoomNumber">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á</label>
                    <input type="text" id="roomNumber" placeholder="‡πÄ‡∏ä‡πà‡∏ô 301, A-205">
                </div>
                
                <div class="form-group">
                    <label id="labelLocationName">‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î/‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</label>
                    <input type="text" id="locationName" placeholder="‡πÄ‡∏ä‡πà‡∏ô The Crest Sukhumvit 34">
                </div>
                
                <div class="form-group">
                    <label id="labelLocationType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                    <select id="locationType">
                        <option value="condominium">‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°</option>
                        <option value="housing_estate">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label id="labelPickupPoint">‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤</label>
                    <input type="text" id="pickupPoint" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ‡∏ä‡∏±‡πâ‡∏ô 1, ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô">
                </div>
                
                <button type="button" class="btn btn-primary" id="btnRegister" onclick="registerNewCustomer()">
                    ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
                </button>
            </form>
        </div>
        
        <!-- Service Selection (Existing Customers) -->
        <div id="serviceSection" class="section">
            <h2 id="serviceTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
            
            <!-- Info Box -->
            <div class="info-box">
                <p style="margin: 0; font-size: 14px;">
                    ‚ö†Ô∏è <span id="specialItemsNote">‡∏ú‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ñ‡∏¥‡∏î‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</span>
                </p>
                <p style="margin: 8px 0 0 0; font-size: 13px; color: #666;" id="seePriceList">
                    üìã ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô Rich Menu
                </p>
            </div>
            
            <div class="form-group">
                <label id="labelServiceType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
                <select id="serviceType" onchange="updateServiceOptions()">
                    <option value="" id="selectServiceType">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</option>
                    <option value="package" id="packageType">Package (‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à)</option>
                    <option value="perpiece" id="perpieceType">‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</option>
                </select>
            </div>
            
            <!-- Package Options -->
            <div id="packageOptions" class="hidden">
                <h3 id="packageTitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package</h3>
                <div id="packageGrid"></div>
                
                <div id="addonSection" class="hidden">
                    <h3 id="addonTitle" style="margin-top: 20px;">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)</h3>
                    <div id="addonOptions"></div>
                </div>
                
                <div id="priceSummary" class="price-summary hidden">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span id="summaryPackage">Package:</span>
                        <span id="summaryPackagePrice"></span>
                    </div>
                    <div id="addonRow" style="display: flex; justify-content: space-between; margin-bottom: 10px;" class="hidden">
                        <span id="summaryAddon">Add-on:</span>
                        <span id="summaryAddonPrice"></span>
                    </div>
                    <div style="border-top: 2px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700;">
                            <span id="summaryTotal">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:</span>
                            <span id="summaryTotalPrice"></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Per-piece Note -->
            <div id="perpieceNote" class="hidden">
                <div class="info-box">
                    <h3>üí∞ ‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô</h3>
                    <p id="perpieceText">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏±‡∏ö‡∏ú‡πâ‡∏≤</p>
                </div>
            </div>
            
            <!-- Notes -->
            <div class="form-group" style="margin-top: 20px;">
                <label id="labelNotes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                <textarea id="orderNotes" rows="3" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å, ‡∏£‡∏µ‡∏ö‡∏î‡πà‡∏ß‡∏ô"></textarea>
            </div>
            
            <button class="btn btn-primary" id="btnSubmit" onclick="submitOrder()">
                ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            </button>
        </div>
        
        <!-- Success Screen -->
        <div id="successSection" class="section">
            <div class="success-message">
                <div class="success-icon">‚úì</div>
                <h2 id="successTitle">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                
                <div style="background: #f5f5f5; padding: 15px; border-radius: 10px; margin: 20px 0;">
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">
                        üìã <span id="labelRequestId">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span> <strong id="orderIdDisplay"></strong>
                    </p>
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">
                        üè¢ <span id="locationNameDisplay"></span>
                    </p>
                    <p style="margin: 5px 0; font-size: 14px; color: #666;">
                        üè† <span id="labelRoom">‡∏´‡πâ‡∏≠‡∏á:</span> <span id="roomNumberDisplay"></span>
                    </p>
                </div>
                
                <div style="background: #fff9e6; padding: 12px; border-radius: 8px; margin: 15px 0;">
                    <p style="font-size: 14px; margin: 0;" id="successReminder">
                        üí° ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ñ‡∏∏‡∏á‡∏ú‡πâ‡∏≤‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏ô‡∏∞‡∏Ñ‡∏∞ üì∏
                    </p>
                </div>
                
                <button class="btn btn-primary" id="btnOrderAnother" onclick="orderAnother()" 
                        style="margin-bottom: 10px;">
                    üì¶ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>
                
                <button class="btn btn-secondary" id="btnClose" onclick="liff.closeWindow()">
                    ‚úì ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const LIFF_ID = '2008998734-1sLeZe9e'; // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const API_URL = 'https://script.google.com/macros/s/AKfycbyqUrB-asBige9bgT38j4mEPzNbt4m3y6WxUxTrov237KfoBB52cYz-35FfgB26mxeeLg/exec'; // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏õ‡πá‡∏ô API URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        
        // Global Variables
        let userId = '';
        let displayName = '';
        let customerData = null;
        let currentLanguage = 'th';
        let selectedPackage = null;
        let selectedAddon = null;
        
        // Language Definitions
        const lang = {
            th: {
                mainTitle: '‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å‡∏£‡∏µ‡∏î',
                subtitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
                loadingText: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...',
                registerTitle: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',
                infoBoxText: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô LINE chat ‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:',
                infoPhoto: 'üì∏ ‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢‡∏ú‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏±‡∏Å',
                infoLocation: 'üìç ‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏≠‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)',
                infoNote: '(‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ)',
                labelRoomNumber: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á',
                placeholderRoomNumber: '‡πÄ‡∏ä‡πà‡∏ô 301, A-205',
                labelLocationName: '‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î/‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô',
                placeholderLocationName: '‡πÄ‡∏ä‡πà‡∏ô The Crest Sukhumvit 34',
                labelLocationType: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó',
                labelPickupPoint: '‡∏à‡∏∏‡∏î‡∏£‡∏±‡∏ö-‡∏™‡πà‡∏á‡∏ú‡πâ‡∏≤',
                placeholderPickupPoint: '‡πÄ‡∏ä‡πà‡∏ô ‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ‡∏ä‡∏±‡πâ‡∏ô 1, ‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô',
                btnRegister: '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô',
                serviceTitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                specialItemsNote: '‡∏ú‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ñ‡∏¥‡∏î‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô',
                seePriceList: 'üìã ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏ô Rich Menu',
                labelServiceType: '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                selectServiceType: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£',
                packageType: 'Package (‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à)',
                perpieceType: '‡∏£‡∏≤‡∏¢‡∏ä‡∏¥‡πâ‡∏ô',
                packageTitle: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package',
                addonTitle: '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ)',
                summaryPackage: 'Package:',
                summaryAddon: 'Add-on:',
                summaryTotal: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°:',
                perpieceText: '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏¥‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏Ñ‡∏¥‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏ô‡∏±‡∏ö‡∏ú‡πâ‡∏≤',
                labelNotes: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)',
                placeholderNotes: '‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å, ‡∏£‡∏µ‡∏ö‡∏î‡πà‡∏ß‡∏ô',
                btnSubmit: '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£',
                successTitle: '‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                labelRequestId: '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:',
                labelRoom: '‡∏´‡πâ‡∏≠‡∏á:',
                successReminder: 'üí° ‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏ñ‡∏∏‡∏á‡∏ú‡πâ‡∏≤‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏ô‡∏∞‡∏Ñ‡∏∞ üì∏',
                btnOrderAnother: 'üì¶ ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°',
                btnClose: '‚úì ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß'
            },
            en: {
                mainTitle: 'Laundry Service',
                subtitle: 'Select your service',
                loadingText: 'Loading...',
                registerTitle: 'New Customer Registration',
                infoBoxText: 'Please send the following in this LINE chat directly:',
                infoPhoto: 'üì∏ Photo of your laundry',
                infoLocation: 'üìç Location for pickup/delivery (only if outside scheduled areas)',
                infoNote: '(No need to upload here)',
                labelRoomNumber: 'Room Number',
                placeholderRoomNumber: 'e.g. 301, A-205',
                labelLocationName: 'Condo/Village Name',
                placeholderLocationName: 'e.g. The Crest Sukhumvit 34',
                labelLocationType: 'Type',
                labelPickupPoint: 'Pickup Point',
                placeholderPickupPoint: 'e.g. Lobby Floor 1, House Front',
                btnRegister: 'Register',
                serviceTitle: 'Select Service',
                specialItemsNote: 'Special items charged separately',
                seePriceList: 'üìã See price list in Rich Menu',
                labelServiceType: 'Service Type',
                selectServiceType: 'Select Service Type',
                packageType: 'Package',
                perpieceType: 'Per Piece',
                packageTitle: 'Select Package',
                addonTitle: 'Add-on Services (Optional)',
                summaryPackage: 'Package:',
                summaryAddon: 'Add-on:',
                summaryTotal: 'Total:',
                perpieceText: 'Price calculated by actual piece count after inspection',
                labelNotes: 'Notes (Optional)',
                placeholderNotes: 'e.g. Separate whites, Express',
                btnSubmit: 'Submit Request',
                successTitle: 'Request Submitted!',
                labelRequestId: 'Request ID:',
                labelRoom: 'Room:',
                successReminder: 'üí° Please send laundry photo in chat üì∏',
                btnOrderAnother: 'üì¶ Add Another',
                btnClose: '‚úì Done'
            }
        };
        
        // Package Definitions
        const packages = {
            th: [
                { id: 'wash_iron_50', name: '‡∏ã‡∏±‡∏Å+‡∏£‡∏µ‡∏î 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 800, size: '50' },
                { id: 'wash_iron_100', name: '‡∏ã‡∏±‡∏Å+‡∏£‡∏µ‡∏î 100 ‡∏ä‡∏¥‡πâ‡∏ô', bonus: '‡πÅ‡∏ñ‡∏°‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏ô‡∏ß‡∏°‡∏ü‡∏£‡∏µ!', price: 1600, size: '100' },
                { id: 'iron_50', name: '‡∏£‡∏µ‡∏î 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 400, size: '50' },
                { id: 'iron_100', name: '‡∏£‡∏µ‡∏î 100 ‡∏ä‡∏¥‡πâ‡∏ô', price: 800, size: '100' },
                { id: 'wash_dry_50', name: '‡∏ã‡∏±‡∏Å+‡∏≠‡∏ö 50 ‡∏ä‡∏¥‡πâ‡∏ô', price: 600, size: '50' },
                { id: 'wash_dry_100', name: '‡∏ã‡∏±‡∏Å+‡∏≠‡∏ö 100 ‡∏ä‡∏¥‡πâ‡∏ô', price: 1200, size: '100' }
            ],
            en: [
                { id: 'wash_iron_50', name: 'Wash+Iron 50 pcs', price: 800, size: '50' },
                { id: 'wash_iron_100', name: 'Wash+Iron 100 pcs', bonus: 'Free duvet wash!', price: 1600, size: '100' },
                { id: 'iron_50', name: 'Iron 50 pcs', price: 400, size: '50' },
                { id: 'iron_100', name: 'Iron 100 pcs', price: 800, size: '100' },
                { id: 'wash_dry_50', name: 'Wash+Dry 50 pcs', price: 600, size: '50' },
                { id: 'wash_dry_100', name: 'Wash+Dry 100 pcs', price: 1200, size: '100' }
            ]
        };
        
        // Addon Definitions
        const addons = {
            th: [
                { id: 'separate_50', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 150, size: '50' },
                { id: 'separate_100', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 300, size: '100' },
                { id: 'hand_wash_50', name: '‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 200, size: '50' },
                { id: 'hand_wash_100', name: '‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 400, size: '100' },
                { id: 'both_50', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å+‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (50 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 300, size: '50' },
                { id: 'both_100', name: '‡∏ã‡∏±‡∏Å‡πÅ‡∏¢‡∏Å+‡∏ã‡∏±‡∏Å‡∏°‡∏∑‡∏≠ (100 ‡∏ä‡∏¥‡πâ‡∏ô)', price: 600, size: '100' }
            ],
            en: [
                { id: 'separate_50', name: 'Separate Wash (50 pcs)', price: 150, size: '50' },
                { id: 'separate_100', name: 'Separate Wash (100 pcs)', price: 300, size: '100' },
                { id: 'hand_wash_50', name: 'Hand Wash (50 pcs)', price: 200, size: '50' },
                { id: 'hand_wash_100', name: 'Hand Wash (100 pcs)', price: 400, size: '100' },
                { id: 'both_50', name: 'Separate+Hand Wash (50 pcs)', price: 300, size: '50' },
                { id: 'both_100', name: 'Separate+Hand Wash (100 pcs)', price: 600, size: '100' }
            ]
        };
        
        // Initialize LIFF
        liff.init({ liffId: LIFF_ID })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                } else {
                    initializeApp();
                }
            })
            .catch((err) => {
                console.error('LIFF init error:', err);
                showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ');
            });
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            showSection('errorSection');
        }
        
        async function callGoogleAPI(params) {
            const queryString = Object.keys(params)
                .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                .join('&');
            
            try {
                const response = await fetch(`${API_URL}?${queryString}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API call error:', error);
                throw error;
            }
        }
        
        async function initializeApp() {
            try {
                const profile = await liff.getProfile();
                userId = profile.userId;
                displayName = profile.displayName;
                console.log('Profile loaded:', displayName);
                
                const data = await callGoogleAPI({
                    action: 'checkCustomer',
                    userId: userId
                });
                
                console.log('Customer status:', data);
                
                if (data.success && data.data.isNewCustomer) {
                    showSection('newCustomerSection');
                } else if (data.success) {
                    customerData = data.data.customerData;
                    currentLanguage = customerData.language || 'th';
                    setLanguage(currentLanguage);
                    
                    showSection('serviceSection');
                    
                    setTimeout(() => {
                        if (customerData.lastPackage) {
                            console.log('Last package found:', customerData.lastPackage);
                            autoSelectLastPackage(customerData.lastPackage, customerData.lastAddon, customerData.lastServiceType);
                        }
                    }, 300);
                } else {
                    showError('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
                }
            } catch (error) {
                console.error('Init error:', error);
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }
        
        async function registerNewCustomer() {
            const roomNumber = document.getElementById('roomNumber').value.trim();
            const locationName = document.getElementById('locationName').value.trim();
            const locationType = document.getElementById('locationType').value;
            const pickupPoint = document.getElementById('pickupPoint').value.trim();
            
            if (!roomNumber || !locationName || !pickupPoint) {
                alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô' : 'Please fill in all required fields');
                return;
            }
            
            try {
                showSection('loadingSection');
                
                const data = await callGoogleAPI({
                    action: 'registerCustomer',
                    userId,
                    displayName,
                    roomNumber,
                    locationName,
                    locationType,
                    pickupPoint,
                    language: currentLanguage
                });
                
                if (data.success) {
                    customerData = { roomNumber, locationName, locationType, pickupPoint };
                    showSection('serviceSection');
                } else {
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            } catch (error) {
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }
        
        async function submitOrder() {
            const serviceType = document.getElementById('serviceType').value;
            
            if (!serviceType) {
                alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£' : 'Please select service type');
                return;
            }
            
            if (serviceType === 'package' && !selectedPackage) {
                alert(currentLanguage === 'th' ? '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Package' : 'Please select a package');
                return;
            }
            
            try {
                showSection('loadingSection');
                
                const data = await callGoogleAPI({
                    action: 'submitOrder',
                    userId,
                    roomNumber: customerData.roomNumber,
                    locationName: customerData.locationName,
                    serviceType,
                    packageType: selectedPackage ? selectedPackage.id : 'perpiece',
                    addOnService: selectedAddon ? selectedAddon.id : '',
                    totalPrice: selectedPackage ? (selectedPackage.price + (selectedAddon ? selectedAddon.price : 0)) : 0,
                    notes: document.getElementById('orderNotes').value
                });
                
                if (data.success) {
                    document.getElementById('orderIdDisplay').textContent = data.data.orderId;
                    document.getElementById('locationNameDisplay').textContent = customerData.locationName;
                    document.getElementById('roomNumberDisplay').textContent = customerData.roomNumber;
                    showSection('successSection');
                } else {
                    showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + data.message);
                }
            } catch (error) {
                showError('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            }
        }
        
        function orderAnother() {
            selectedAddon = null;
            document.getElementById('orderNotes').value = '';
            showSection('serviceSection');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function setLanguage(newLang) {
            currentLanguage = newLang;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((newLang === 'th' && btn.textContent === '‡πÑ‡∏ó‡∏¢') || 
                    (newLang === 'en' && btn.textContent === 'English')) {
                    btn.classList.add('active');
                }
            });
            
            updateLanguage();
        }
        
        function updateLanguage() {
            const l = lang[currentLanguage];
            
            document.getElementById('mainTitle').textContent = l.mainTitle;
            document.getElementById('subtitle').textContent = l.subtitle;
            document.getElementById('loadingText').textContent = l.loadingText;
            document.getElementById('registerTitle').textContent = l.registerTitle;
            document.getElementById('infoBoxText').textContent = l.infoBoxText;
            document.getElementById('infoPhoto').textContent = l.infoPhoto;
            document.getElementById('infoLocation').textContent = l.infoLocation;
            document.getElementById('infoNote').textContent = l.infoNote;
            document.getElementById('labelRoomNumber').textContent = l.labelRoomNumber;
            document.getElementById('roomNumber').placeholder = l.placeholderRoomNumber;
            document.getElementById('labelLocationName').textContent = l.labelLocationName;
            document.getElementById('locationName').placeholder = l.placeholderLocationName;
            document.getElementById('labelLocationType').textContent = l.labelLocationType;
            document.getElementById('labelPickupPoint').textContent = l.labelPickupPoint;
            document.getElementById('pickupPoint').placeholder = l.placeholderPickupPoint;
            document.getElementById('btnRegister').textContent = l.btnRegister;
            document.getElementById('serviceTitle').textContent = l.serviceTitle;
            document.getElementById('specialItemsNote').textContent = l.specialItemsNote;
            document.getElementById('seePriceList').textContent = l.seePriceList;
            document.getElementById('labelServiceType').textContent = l.labelServiceType;
            document.getElementById('packageTitle').textContent = l.packageTitle;
            document.getElementById('addonTitle').textContent = l.addonTitle;
            document.getElementById('summaryPackage').textContent = l.summaryPackage;
            document.getElementById('summaryAddon').textContent = l.summaryAddon;
            document.getElementById('summaryTotal').textContent = l.summaryTotal;
            document.getElementById('perpieceText').textContent = l.perpieceText;
            document.getElementById('labelNotes').textContent = l.labelNotes;
            document.getElementById('orderNotes').placeholder = l.placeholderNotes;
            document.getElementById('btnSubmit').textContent = l.btnSubmit;
            document.getElementById('successTitle').textContent = l.successTitle;
            document.getElementById('labelRequestId').textContent = l.labelRequestId;
            document.getElementById('labelRoom').textContent = l.labelRoom;
            document.getElementById('successReminder').textContent = l.successReminder;
            document.getElementById('btnOrderAnother').textContent = l.btnOrderAnother;
            document.getElementById('btnClose').textContent = l.btnClose;
            
            const serviceTypeSelect = document.getElementById('serviceType');
            if (serviceTypeSelect) {
                const currentValue = serviceTypeSelect.value;
                serviceTypeSelect.innerHTML = `
                    <option value="">${l.selectServiceType}</option>
                    <option value="package">${l.packageType}</option>
                    <option value="perpiece">${l.perpieceType}</option>
                `;
                serviceTypeSelect.value = currentValue;
            }
            
            if (!document.getElementById('packageOptions').classList.contains('hidden')) {
                renderPackages();
                if (selectedPackage) {
                    renderAddons(selectedPackage.size);
                }
            }
        }
        
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
        }
        
        function updateServiceOptions() {
            const serviceType = document.getElementById('serviceType').value;
            document.getElementById('packageOptions').classList.toggle('hidden', serviceType !== 'package');
            document.getElementById('perpieceNote').classList.toggle('hidden', serviceType !== 'perpiece');
            document.getElementById('priceSummary').classList.add('hidden');
            
            if (serviceType === 'package') {
                renderPackages();
            }
        }
        
        function renderPackages() {
            const grid = document.getElementById('packageGrid');
            grid.innerHTML = '';
            
            packages[currentLanguage].forEach(pkg => {
                const card = document.createElement('div');
                card.className = 'package-card';
                if (selectedPackage && selectedPackage.id === pkg.id) {
                    card.classList.add('selected');
                }
                card.onclick = () => selectPackage(pkg, card);
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 16px; color: #333;">${pkg.name}</div>
                            ${pkg.bonus ? `<div style="color: #667eea; font-size: 12px; margin-top: 5px;">üéÅ ${pkg.bonus}</div>` : ''}
                            <div style="color: #ff9800; font-size: 11px; margin-top: 5px;">
                                ‚ö†Ô∏è ${currentLanguage === 'th' ? '‡∏ú‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ñ‡∏¥‡∏î‡πÅ‡∏¢‡∏Å' : 'Special items charged separately'}
                            </div>
                        </div>
                        <div style="font-weight: 700; font-size: 18px; color: #667eea;">${pkg.price} ‡∏ø</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        function selectPackage(pkg, cardElement) {
            selectedPackage = pkg;
            selectedAddon = null;
            
            document.querySelectorAll('.package-card').forEach(c => c.classList.remove('selected'));
            cardElement.classList.add('selected');
            
            document.getElementById('addonSection').classList.remove('hidden');
            renderAddons(pkg.size);
            updatePriceSummary();
        }
        
        function renderAddons(packageSize) {
            const container = document.getElementById('addonOptions');
            container.innerHTML = '';
            
            addons[currentLanguage].filter(a => a.size === packageSize).forEach(addon => {
                const card = document.createElement('div');
                card.className = 'addon-card';
                if (selectedAddon && selectedAddon.id === addon.id) {
                    card.classList.add('selected');
                }
                card.onclick = () => selectAddon(addon, card);
                
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between;">
                        <span>${addon.name}</span>
                        <span style="font-weight: 700; color: #667eea;">+${addon.price} ‡∏ø</span>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        function selectAddon(addon, cardElement) {
            if (selectedAddon && selectedAddon.id === addon.id) {
                selectedAddon = null;
                cardElement.classList.remove('selected');
            } else {
                selectedAddon = addon;
                document.querySelectorAll('.addon-card').forEach(c => c.classList.remove('selected'));
                cardElement.classList.add('selected');
            }
            updatePriceSummary();
        }
        
        function updatePriceSummary() {
            if (!selectedPackage) return;
            
            document.getElementById('priceSummary').classList.remove('hidden');
            const total = selectedPackage.price + (selectedAddon ? selectedAddon.price : 0);
            
            document.getElementById('summaryPackagePrice').textContent = selectedPackage.price + ' ‡∏ø';
            document.getElementById('addonRow').classList.toggle('hidden', !selectedAddon);
            
            if (selectedAddon) {
                document.getElementById('summaryAddonPrice').textContent = '+' + selectedAddon.price + ' ‡∏ø';
            }
            
            document.getElementById('summaryTotalPrice').textContent = total + ' ‡∏ø';
        }
        
        function autoSelectLastPackage(lastPackageId, lastAddonId, lastServiceType) {
            console.log('Auto-selecting package:', lastPackageId, lastAddonId, lastServiceType);
            
            if (lastServiceType) {
                const serviceTypeSelect = document.getElementById('serviceType');
                if (!serviceTypeSelect) {
                    console.error('serviceType element not found');
                    return;
                }
                
                serviceTypeSelect.value = lastServiceType;
                
                if (lastServiceType === 'package') {
                    const packageOptions = document.getElementById('packageOptions');
                    const perpieceSection = document.getElementById('perpieceNote');
                    
                    if (packageOptions) {
                        packageOptions.classList.remove('hidden');
                    }
                    if (perpieceSection) {
                        perpieceSection.classList.add('hidden');
                    }
                    
                    renderPackages();
                    
                    setTimeout(() => {
                        const packageToSelect = packages[currentLanguage].find(p => p.id === lastPackageId);
                        
                        if (packageToSelect) {
                            const packageCards = document.querySelectorAll('.package-card');
                            
                            if (packageCards.length === 0) {
                                console.error('No package cards found');
                                return;
                            }
                            
                            packageCards.forEach((card, index) => {
                                const pkg = packages[currentLanguage][index];
                                if (pkg && pkg.id === lastPackageId) {
                                    selectPackage(pkg, card);
                                    
                                    if (card && card.scrollIntoView) {
                                        card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                    }
                                    
                                    if (lastAddonId) {
                                        setTimeout(() => {
                                            const addonToSelect = addons[currentLanguage].find(a => 
                                                a.id === lastAddonId && a.size === packageToSelect.size
                                            );
                                            
                                            if (addonToSelect) {
                                                const addonCards = document.querySelectorAll('.addon-card');
                                                
                                                if (addonCards.length > 0) {
                                                    addonCards.forEach((addonCard, addonIndex) => {
                                                        const availableAddons = addons[currentLanguage].filter(a => a.size === packageToSelect.size);
                                                        const addon = availableAddons[addonIndex];
                                                        if (addon && addon.id === lastAddonId) {
                                                            selectAddon(addon, addonCard);
                                                        }
                                                    });
                                                }
                                            }
                                        }, 300);
                                    }
                                }
                            });
                        }
                    }, 200);
                }
            }
        }
    </script>
</body>
</html>
